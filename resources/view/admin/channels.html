{include file="admin/header"}

<head>
    <title>转运方式与报价</title>
</head>

<body>
<div class="page-wrapper">
    <div class="container">
        <div class="page-content">
            <div class="card" style="margin-top: 2%">
                <div class="card-header">
                    <h2 class="card-title">通道列表 <a class='btn btn-cyan' href='/admin/channels/add'><i
                            class="fas fa-plus"></i>添加通道</a></h2>
                    <a class='btn btn-dark' href='/admin' style="margin-left: auto"><i class="fas fa-back"></i>返回</a>
                </div>

                {if $channels->isEmpty()}
                <div class="empty">
                    <div class="empty-title">
                        暂无数据
                    </div>
                </div>
                {else}
                <div class="card-body">
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th>名称</th>
                            <th>时效（天）</th>
                            <th>首重（0.5kg）</th>
                            <th>续重（CNY/0.5KG）</th>
                            <th>备注</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                {volist name="channels" id="channel"}
                        <tr>
                            <td>{$channel.name}</td>
                            <td>{$channel.effectiveness}</td>
                            <td>{$channel.firstPrice}</td>
                            <td>{$channel.laterPrice}</td>
                            <td>{$channel.comment}</td>
                            <td>
                                <a class="btn btn-primary" href="/admin/channels/{$channel.id}">编辑</a>
                                <button class="btn btn-danger" type="button" data-id="{$channel.id}">删除</button>
                            </td>
                        </tr>
                        {/volist}
                        </tbody>
                    </table>

                    <!-- 分页链接 -->
                    {$channels|raw}
                </div>
            </div>
            {/if}

        </div>
    </div>
</div>
<script>
    $('.btn-danger').each(function () {
        $(this).click(function () {
            var Id = $(this).attr('data-id');
            Swal.fire({
                title: '您确定要删除该通道吗？',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '确认删除',
                cancelButtonText: '取消'
            }).then(function (result) {
                if (result.value) {
                    $.ajax({
                        url: '/admin/channels/' + Id,
                        type: 'DELETE',
                        success: function (data) {
                            if (data.ret === 1) {
                                Swal.fire({
                                    title: '成功',
                                    text: data.msg,
                                    confirmButtonText: '确定',
                                    icon: 'success'
                                }).then(function (result) {
                                    if (result.value) {
                                        location.reload();
                                    }
                                });
                                setTimeout(function () {
                                    location.reload();
                                }, 2000);
                            } else {
                                Swal.fire({
                                    icon: 'error',
                                    title: '错误',
                                    text: data.msg
                                });
                            }
                        },
                        error: function () {
                            Swal.fire({
                                icon: 'error',
                                title: '错误',
                                text: '系统错误'
                            }).then(function (result) {
                                if (result.value) {
                                    location.reload();
                                }
                            });
                        }
                    });
                }
            });
        });
    });
</script>

</body>
